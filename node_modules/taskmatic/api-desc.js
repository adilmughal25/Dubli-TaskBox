"use strict";

function * task1 () {
  console.log("task1 running", this.task);
}

function * task2 () {
  console.log("task2 running", this.task);
}

function * task3 () {
  console.log("task3 running", this.task);
}

const TaskMatic = require('./taskmatic');
const taskmatic = new TaskMatic({
  dbPath: "./foo.db",
  cooldown: '0.5s'
});

taskmatic.on('task-will-start', function(taskId) {
  console.log("Task Initialized: "+taskId);
});
taskmatic.on('task-start', function(task) {
  console.log("Started task: "+task.id);
});
taskmatic.on('task-error', function(task, error) {
  console.error("Task Error: "+task.id, error);
});
taskmatic.on('task-done', function(task) {
  console.log("Task Finished: "+task.id);
});
taskmatic.on('task-find-error', function(taskId, error) {
  console.log('couldnt find task with id '+taskId + ': '+error);
});
taskmatic.on('task-registered', function(task) {
  console.log('task registered', task);
});

taskmatic.schedule('task-1', '30s', task1);
taskmatic.schedule('task-2', '3m +/- 15s', task2);
taskmatic.schedule('task-3', '15s - 20s', task3);

taskmatic.start().then(() => console.log("Started up!"), e=>console.error(e.stack));
