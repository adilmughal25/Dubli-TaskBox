#!/usr/bin/env ruby

# This pre-push hook will prevent any commit to forbidden branches.
# Put this file in your local repo, in the .git/hooks folder
# and make sure it is executable.
# The name of the file *must* be "pre-push" for Git to pick it up.

FORBIDDEN_BRANCHES = ["prod"]

def current_branch()
  branches = `git branch --no-color`.split(/\n/)
  current = branches.select{ |b| b =~ /\s*\*/ }.first
  current.gsub(/[\*\s]/, "")
end

branch = current_branch

if (FORBIDDEN_BRANCHES.include?(branch))
  puts
  puts " STOP THE PRESS!"
  puts " You are trying to push to the *#{branch}* branch."
  puts " Surely you don't mean that?"
  puts
  puts " If you really do, force the push by adding --no-verify to the command."
  puts

  exit 1
end
