'use strict';

let dataClient;

function * getCategoryById (categoryId, ctx) {
  let result = yield dataClient.get('/getCategoryById/' + categoryId + '/', null, ctx);
  ctx.assert(result.statusCode !== 404, 404, 'Category not found', {internalCode: 130});
  return result.body;
}

function * getCategoryBySlug (slug, lang, region, ctx) {
  let result = yield dataClient.get('/getCategoryBySlug/' + slug + '/', {lang: lang, region: region}, ctx);
  ctx.assert(result.statusCode !== 404, 404, 'Category not found', {internalCode: 130});
  return result.body;
}

function * getCategories (region, language, ctx) {
  let result = yield dataClient.get('/getCategories/', {region: region, language: language}, ctx);
  ctx.assert(result.statusCode !== 404, 404, 'No categories found', {internalCode: 131});
  return result.body;
}

module.exports = function init (config) {
  dataClient = require('../utils/rest-client')(config.data_api, false);
  return {
    getCategoryById: getCategoryById,
    getCategoryBySlug: getCategoryBySlug,
    getCategories: getCategories
  };
};
