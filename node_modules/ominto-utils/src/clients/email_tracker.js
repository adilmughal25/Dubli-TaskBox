'use strict';

//const toQueryString = require('../utils/url').toQueryString;
const helpers = require('./helpers');

let dataClient;

module.exports = function init (configs) {
  dataClient = require('../utils').getDataClient(configs.data_api.internalUrl, configs.data_api.auth);
  return {
    insertEmailLog: insertEmailLog
  };
};

function * insertEmailLog (mailObject, ctx) {
  let result = yield dataClient.post(helpers.setRequestPayload('/insertEmailLog/', ctx, mailObject));

  ctx.assert(result.statusCode === 200, 500, 'Unexpected result from data service during creating email log', {
    res: result,
    mail_subject: mailObject.mail_subject,
    internalCode: 351
  });
  return result.body;
}