'use strict';

var _ = require('lodash');

/**
 * @function parseResponse
 *
 * Function to be used to transform the response body that is returned via a
 * request-promise request, parsing the response body to usable json.
 *
 * @return {object} parsed response body
 */
function parseResponse (body) {
  return JSON.parse(body);
}

function * setRedirect (ctx) {
  if (ctx.request.query && ctx.request.query.redirect_uri) {
    return ctx.request.query.redirect_uri;
  } else {
    return null;
  }
}

function * setScope (s_scope, ctx) {
  if (ctx.request.query && ctx.request.query.scope) {
    return ctx.request.query.scope;
  } else {
    return s_scope.join(' ');
  }
}

function * setState (redirect, stateToken) {
  if (_.isNull(redirect)) {
    return JSON.stringify({state_token: stateToken});
  } else {
    return JSON.stringify({state_token: stateToken, url: redirect});
  }
}

module.exports = {
  parseResponse: parseResponse,
  setRedirect: setRedirect,
  setScope: setScope,
  setState: setState
};
