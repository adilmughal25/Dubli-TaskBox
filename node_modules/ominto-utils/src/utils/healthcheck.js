'use strict';

var _ = require('lodash');

// in situations where you don't have the koa context (see response logging in API) you can send in the logger directly
function isReqHealthcheck (context, logger) {
  // check context.path
  if (!_.isEmpty(context) && _.isString(context.path) && context.path.indexOf('healthcheck') > -1) {
    return true;
  }

  // check context.state.logger.fields.path
  if (!_.isEmpty(context) && !_.isEmpty(context.state) && !_.isEmpty(context.state.logger)) {
    return _checkLogger(context.state.logger);
  }

  // check logger.fields.path
  if (!_.isEmpty(logger)) {
    return _checkLogger(logger);
  }

  return false;
}

function _checkLogger (logger) {
  // check logger.fields.path
  if (!_.isEmpty(logger.fields) && _.isString(logger.fields.path) && logger.fields.path.indexOf('healthcheck') > -1) {
    return true;
  }

  // check logger.fields.session_id
  if (!_.isEmpty(logger.fields) && _.isString(logger.fields.session_id) && logger.fields.session_id.indexOf('healthcheck') > -1) {
    return true;
  }

  return false;
}

module.exports = {
  isReqHealthcheck: isReqHealthcheck
};
