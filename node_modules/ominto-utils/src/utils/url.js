'use strict';

var _ = require('lodash');

function toQueryString (obj, compactArrays) {
  var qs = toQueryParams(obj, compactArrays);
  return qs ? '?' + qs : '';
}

function _escape (value, compactArrays) {
  var result;
  if (_.isArray(value)) {
    result = '[' + value.map(element => encodeURIComponent(_.isString(element) ? '"' + element + '"' : element)).join(compactArrays ? ',' : ', ') + ']';
  } else {
    result = encodeURIComponent(_.isObject(value) ? JSON.stringify(value) : value);
  }
  return result;
}

function toQueryParams (obj, compactArrays) {
  var parts = [];
  _.each(obj, (value, key) => {
    if (value || value === 0) {
      parts.push(key + '=' + _escape(value, compactArrays));
    }
  });
  return parts.join('&');
}

module.exports = {
  toQueryString: toQueryString,
  toQueryParams: toQueryParams
};
