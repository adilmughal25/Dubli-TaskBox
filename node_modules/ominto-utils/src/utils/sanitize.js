'use strict';

const _ = require('lodash');

function nullAndUndefined(body) {
  if (!body) return body;
  if (_.isArray(body)) return body.map(nullAndUndefined).filter(v => v !== undefined && v !== null);
  if (_.isFunction(body) || _.isRegExp(body)) return body;
  if (!_.isObject(body)) return body;

  return Object.keys(body).reduce(function(res, key) {
    var val = body[key];
    if (_.isUndefined(val) || _.isNull(val)) return res;
    if (_.isArray(val) || _.isObject(val)) return _.set(res, key, nullAndUndefined(val));
    return _.set(res, key, val);
  }, {});
}

function nullUndefinedEmpty(body) {
  if (!body) return body;
  if (_.isArray(body)) return body.map(nullUndefinedEmpty).filter(v => v !== undefined && v !== null && v !== "");
  if (_.isFunction(body) || _.isRegExp(body)) return body;
  if (!_.isObject(body)) return body;

  return Object.keys(body).reduce(function(res, key) {
    var val = body[key];
    if (_.isUndefined(val) || _.isNull(val) || val === "") return res;
    if (_.isArray(val) || _.isObject(val)) return _.set(res, key, nullUndefinedEmpty(val));
    return _.set(res, key, val);
  }, {});
}

module.exports = {
  nullAndUndefined: nullAndUndefined,
  nullUndefinedEmpty: nullUndefinedEmpty
};
