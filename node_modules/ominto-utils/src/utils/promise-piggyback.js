'use strict';

var stringify = require('json-stringify-safe');

module.exports = piggyback;

function piggyback (orig) {
  var cache = {};
  var piggybacked = function () {
    var args = stringify(arguments);
    if (cache[args]) return cache[args];
    cache[args] = orig.apply(this, arguments).then(function (val) {
      delete cache[args];
      return val;
    });
    return cache[args];
  };
  return piggybacked;
}
